<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Partners - HealthConnect</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #2563eb;
            --secondary-color: #059669;
            --danger-color: #dc2626;
            --warning-color: #f59e0b;
            --info-color: #0891b2;
            --success-color: #16a34a;
            --dark-bg: #1f2937;
            --card-bg: #ffffff;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .search-filters-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .search-group {
            display: flex;
            flex-direction: column;
        }
        
        .search-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .search-group input,
        .search-group select {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .search-group input:focus,
        .search-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .filter-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .filter-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .compare-btn {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .compare-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
        }
        
        .compare-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .recommended-section {
            margin-bottom: 40px;
        }
        
        .section-title {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .section-title h2 {
            color: #2563eb;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .section-title p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .insurance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
        }
        
        .insurance-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }
        
        .insurance-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }
        
        .insurance-card.recommended {
            border-color: #16a34a;
            background: linear-gradient(135deg, rgba(22, 163, 74, 0.05), rgba(255, 255, 255, 0.95));
        }
        
        .recommended-badge {
            position: absolute;
            top: -10px;
            right: 20px;
            background: linear-gradient(135deg, #16a34a, #059669);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(22, 163, 74, 0.3);
        }
        
        .insurance-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .company-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .company-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .company-details h3 {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 5px;
        }
        
        .company-details .plan-type {
            color: #667eea;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .compare-checkbox {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
            cursor: pointer;
        }
        
        .premium-section {
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .premium-amount {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .premium-period {
            color: #666;
            font-size: 0.9rem;
        }
        
        .coverage-summary {
            margin-bottom: 20px;
        }
        
        .coverage-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .coverage-item:last-child {
            border-bottom: none;
        }
        
        .coverage-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .coverage-value {
            font-weight: 600;
            color: #333;
        }
        
        .coverage-value.unlimited {
            color: #16a34a;
        }
        
        .coverage-details {
            display: none;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .coverage-details.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 500px; }
        }
        
        .features-list {
            list-style: none;
            margin: 10px 0;
        }
        
        .features-list li {
            padding: 5px 0;
            position: relative;
            padding-left: 20px;
        }
        
        .features-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #16a34a;
            font-weight: bold;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        .view-more-btn {
            flex: 1;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 2px solid #667eea;
            padding: 12px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .view-more-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .buy-btn {
            flex: 1;
            background: linear-gradient(135deg, #16a34a, #059669);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .buy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(22, 163, 74, 0.3);
        }
        
        .comparison-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }
        
        .comparison-content {
            background: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 20px;
            width: 95%;
            max-width: 1200px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #333;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .comparison-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .no-results {
            text-align: center;
            padding: 60px;
            color: #666;
        }
        
        .no-results h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .back-btn {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 114, 128, 0.3);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            .insurance-grid {
                grid-template-columns: 1fr;
            }
            
            .card-actions {
                flex-direction: column;
            }
            
            .filter-buttons {
                flex-direction: column;
                align-items: stretch;
            }
            
            .comparison-content {
                width: 98%;
                padding: 20px;
            }
            
            .comparison-table {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-btn" onclick="goBackToDashboard()">‚Üê Back to Dashboard</button>
        
        <div class="header">
            <h1>üè• Insurance Partners</h1>
            <p>Find the perfect health insurance plan tailored to your needs</p>
        </div>
        
        <div class="search-filters-section">
            <div class="search-grid">
                <div class="search-group">
                    <label for="companySearch">Insurance Company</label>
                    <input type="text" id="companySearch" placeholder="Search companies..." oninput="filterInsurance()">
                </div>
                <div class="search-group">
                    <label for="planTypeFilter">Plan Type</label>
                    <select id="planTypeFilter" onchange="filterInsurance()">
                        <option value="">All Plan Types</option>
                        <option value="Individual Health">Individual Health</option>
                        <option value="Family Floater">Family Floater</option>
                        <option value="Critical Illness">Critical Illness</option>
                        <option value="Senior Citizen">Senior Citizen</option>
                        <option value="Maternity">Maternity</option>
                        <option value="Dental & Vision">Dental & Vision</option>
                    </select>
                </div>
                <div class="search-group">
                    <label for="premiumRange">Premium Range (‚Çπ/month)</label>
                    <select id="premiumRange" onchange="filterInsurance()">
                        <option value="">Any Premium</option>
                        <option value="0-1000">‚Çπ0 - ‚Çπ1,000</option>
                        <option value="1000-3000">‚Çπ1,000 - ‚Çπ3,000</option>
                        <option value="3000-5000">‚Çπ3,000 - ‚Çπ5,000</option>
                        <option value="5000+">‚Çπ5,000+</option>
                    </select>
                </div>
                <div class="search-group">
                    <label for="coverageAmount">Coverage Amount</label>
                    <select id="coverageAmount" onchange="filterInsurance()">
                        <option value="">Any Coverage</option>
                        <option value="0-500000">Up to ‚Çπ5 Lakh</option>
                        <option value="500000-1000000">‚Çπ5 - ‚Çπ10 Lakh</option>
                        <option value="1000000-2000000">‚Çπ10 - ‚Çπ20 Lakh</option>
                        <option value="2000000+">‚Çπ20 Lakh+</option>
                    </select>
                </div>
            </div>
            
            <div class="filter-buttons">
                <button class="filter-btn" onclick="refreshInsurance()">üîÑ Refresh</button>
                <button class="filter-btn" onclick="clearFilters()">üóëÔ∏è Clear Filters</button>
                <button class="compare-btn" id="compareBtn" onclick="openComparison()" disabled>
                    üìä Compare Plans (<span id="compareCount">0</span>)
                </button>
            </div>
        </div>
        
        <!-- Recommended Plans Section -->
        <div class="recommended-section">
            <div class="section-title">
                <h2>üéØ Recommended for You</h2>
                <p>Based on your profile: Age 32, Health conditions: Diabetes, Hypertension</p>
            </div>
            <div class="insurance-grid" id="recommendedGrid">
                <!-- Recommended plans will be populated here -->
            </div>
        </div>
        
        <!-- All Plans Section -->
        <div class="section-title">
            <h2>üè• All Available Plans</h2>
            <p>Explore all insurance plans from our partner providers</p>
        </div>
        
        <div id="loadingIndicator" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Loading insurance plans...</p>
        </div>
        
        <div class="insurance-grid" id="insuranceGrid">
            <!-- Insurance cards will be populated here -->
        </div>
        
        <div id="noResults" class="no-results" style="display: none;">
            <h3>No insurance plans found</h3>
            <p>Try adjusting your search filters or contact our support team for assistance.</p>
        </div>
    </div>
    
    <!-- Comparison Modal -->
    <div id="comparisonModal" class="comparison-modal">
        <div class="comparison-content">
            <span class="close" onclick="closeComparison()">&times;</span>
            <h2>üìä Insurance Plan Comparison</h2>
            <div style="overflow-x: auto;">
                <table class="comparison-table" id="comparisonTable">
                    <!-- Comparison table will be populated here -->
                </table>
            </div>
        </div>
    </div>

    <script>
        // Mock insurance data
        let insuranceData = [
            {
                id: 1,
                companyName: "Star Health Insurance",
                planType: "Family Floater",
                planName: "Star Family Health Optima",
                monthlyPremium: 2500,
                yearlyPremium: 28000,
                coverage: 1000000,
                hospitalization: "100% covered",
                daycareProcedures: "100% covered",
                preHospitalization: "30 days",
                postHospitalization: "60 days",
                ambulance: "‚Çπ2,000 per claim",
                roomRent: "2% of sum insured",
                medicine: "Covered under hospitalization",
                surgery: "100% covered",
                maternity: "‚Çπ50,000 after 3 years",
                features: [
                    "Cashless treatment at 9,900+ hospitals",
                    "No room rent capping",
                    "Pre-existing diseases covered after 2 years",
                    "Annual health check-up",
                    "Worldwide emergency coverage"
                ],
                recommended: true,
                website: "https://www.starhealth.in"
            },
            {
                id: 2,
                companyName: "HDFC ERGO Health",
                planType: "Individual Health",
                planName: "My Health Suraksha",
                monthlyPremium: 1800,
                yearlyPremium: 20000,
                coverage: 500000,
                hospitalization: "100% covered",
                daycareProcedures: "100% covered",
                preHospitalization: "30 days",
                postHospitalization: "60 days",
                ambulance: "‚Çπ1,500 per claim",
                roomRent: "1% of sum insured",
                medicine: "Covered under hospitalization",
                surgery: "100% covered",
                maternity: "Not covered",
                features: [
                    "Cashless treatment at 7,200+ hospitals",
                    "Restoration benefit",
                    "Health coach support",
                    "Fitness rewards program",
                    "Mental wellness support"
                ],
                recommended: true,
                website: "https://www.hdfcergo.com"
            },
            {
                id: 3,
                companyName: "Max Bupa Health",
                planType: "Critical Illness",
                planName: "GoActive Critical Illness",
                monthlyPremium: 1200,
                yearlyPremium: 13500,
                coverage: 2000000,
                hospitalization: "Lump sum on diagnosis",
                daycareProcedures: "Covered",
                preHospitalization: "Not applicable",
                postHospitalization: "Not applicable",
                ambulance: "Not covered",
                roomRent: "Not applicable",
                medicine: "Not covered",
                surgery: "Related to critical illness",
                maternity: "Not covered",
                features: [
                    "Covers 37 critical illnesses",
                    "Lump sum payout on diagnosis",
                    "Multiple claim benefit",
                    "Premium waiver on claim",
                    "Health screening benefit"
                ],
                recommended: false,
                website: "https://www.maxbupa.com"
            },
            {
                id: 4,
                companyName: "Care Health Insurance",
                planType: "Senior Citizen",
                planName: "Care Senior",
                monthlyPremium: 3500,
                yearlyPremium: 40000,
                coverage: 1500000,
                hospitalization: "100% covered",
                daycareProcedures: "100% covered",
                preHospitalization: "60 days",
                postHospitalization: "180 days",
                ambulance: "‚Çπ3,000 per claim",
                roomRent: "No capping",
                medicine: "Covered under hospitalization",
                surgery: "100% covered",
                maternity: "Not applicable",
                features: [
                    "No medical check-up up to age 65",
                    "Daily cash allowance",
                    "Home healthcare benefit",
                    "Ayurveda & homeopathy covered",
                    "Mental illness coverage"
                ],
                recommended: false,
                website: "https://www.careinsurance.com"
            },
            {
                id: 5,
                companyName: "Bajaj Allianz Health",
                planType: "Family Floater",
                planName: "Health Guard",
                monthlyPremium: 3200,
                yearlyPremium: 36000,
                coverage: 2000000,
                hospitalization: "100% covered",
                daycareProcedures: "100% covered",
                preHospitalization: "30 days",
                postHospitalization: "60 days",
                ambulance: "‚Çπ2,500 per claim",
                roomRent: "2% of sum insured",
                medicine: "Covered under hospitalization",
                surgery: "100% covered",
                maternity: "‚Çπ75,000 after 2 years",
                features: [
                    "Cashless treatment at 6,500+ hospitals",
                    "Zero waiting period for accidents",
                    "Consumables covered up to ‚Çπ25,000",
                    "Vaccination expenses covered",
                    "Global emergency assistance"
                ],
                recommended: true,
                website: "https://www.bajajallianz.com"
            },
            {
                id: 6,
                companyName: "Niva Bupa Health",
                planType: "Maternity",
                planName: "Reassure 2.0 with Maternity",
                monthlyPremium: 2800,
                yearlyPremium: 32000,
                coverage: 1000000,
                hospitalization: "100% covered",
                daycareProcedures: "100% covered",
                preHospitalization: "30 days",
                postHospitalization: "60 days",
                ambulance: "‚Çπ2,000 per claim",
                roomRent: "No capping",
                medicine: "Covered under hospitalization",
                surgery: "100% covered",
                maternity: "‚Çπ1,00,000 after 10 months",
                features: [
                    "Immediate maternity coverage",
                    "Newborn baby coverage from day 1",
                    "Fertility treatment covered",
                    "Vaccination for newborn",
                    "Post-natal coverage"
                ],
                recommended: false,
                website: "https://www.nivabupa.com"
            },
            {
                id: 7,
                companyName: "ICICI Lombard Health",
                planType: "Individual Health",
                planName: "Complete Health Insurance",
                monthlyPremium: 2200,
                yearlyPremium: 25000,
                coverage: 750000,
                hospitalization: "100% covered",
                daycareProcedures: "100% covered",
                preHospitalization: "30 days",
                postHospitalization: "60 days",
                ambulance: "‚Çπ1,800 per claim",
                roomRent: "1.5% of sum insured",
                medicine: "Covered under hospitalization",
                surgery: "100% covered",
                maternity: "Not covered",
                features: [
                    "Unlimited automatic restoration",
                    "Emergency overseas coverage",
                    "Alternative treatment covered",
                    "Domiciliary treatment",
                    "Health check-up discount"
                ],
                recommended: false,
                website: "https://www.icicilombard.com"
            },
            {
                id: 8,
                companyName: "Aditya Birla Health",
                planType: "Dental & Vision",
                planName: "Active Secure",
                monthlyPremium: 800,
                yearlyPremium: 9000,
                coverage: 300000,
                hospitalization: "Limited coverage",
                daycareProcedures: "Dental procedures covered",
                preHospitalization: "Not applicable",
                postHospitalization: "Not applicable",
                ambulance: "Not covered",
                roomRent: "Not applicable",
                medicine: "Dental medicines covered",
                surgery: "Dental & eye surgery",
                maternity: "Not covered",
                features: [
                    "Comprehensive dental coverage",
                    "Eye care and vision correction",
                    "Routine dental check-ups",
                    "Emergency dental treatment",
                    "Contact lens allowance"
                ],
                recommended: false,
                website: "https://www.adityabirlacapital.com"
            }
        ];

        let filteredInsurance = [...insuranceData];
        let selectedForComparison = [];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateInsuranceGrid();
            updateRecommendedGrid();
        });

        function updateInsuranceGrid() {
            const grid = document.getElementById('insuranceGrid');
            const noResults = document.getElementById('noResults');
            
            const regularPlans = filteredInsurance.filter(plan => !plan.recommended);
            
            if (regularPlans.length === 0) {
                grid.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }
            
            grid.style.display = 'grid';
            noResults.style.display = 'none';
            grid.innerHTML = '';
            
            regularPlans.forEach(plan => {
                const card = createInsuranceCard(plan);
                grid.appendChild(card);
            });
        }

        function updateRecommendedGrid() {
            const grid = document.getElementById('recommendedGrid');
            const recommendedPlans = filteredInsurance.filter(plan => plan.recommended);
            
            grid.innerHTML = '';
            
            recommendedPlans.forEach(plan => {
                const card = createInsuranceCard(plan, true);
                grid.appendChild(card);
            });
        }

        function createInsuranceCard(plan, isRecommended = false) {
            const card = document.createElement('div');
            card.className = `insurance-card ${plan.recommended ? 'recommended' : ''}`;
            
            const isSelected = selectedForComparison.includes(plan.id);
            
            card.innerHTML = `
                ${plan.recommended ? '<div class="recommended-badge">üéØ Recommended</div>' : ''}
                
                <div class="insurance-header">
                    <div class="company-info">
                        <div class="company-logo">${plan.companyName.charAt(0)}</div>
                        <div class="company-details">
                            <h3>${plan.companyName}</h3>
                            <div class="plan-type">${plan.planType}</div>
                        </div>
                    </div>
                    <input type="checkbox" class="compare-checkbox" ${isSelected ? 'checked' : ''} 
                           onchange="toggleComparison(${plan.id})">
                </div>
                
                <div class="premium-section">
                    <div class="premium-amount">‚Çπ${plan.monthlyPremium.toLocaleString()}</div>
                    <div class="premium-period">per month (‚Çπ${plan.yearlyPremium.toLocaleString()}/year)</div>
                </div>
                
                <div class="coverage-summary">
                    <div class="coverage-item">
                        <span class="coverage-label">Sum Insured:</span>
                        <span class="coverage-value">‚Çπ${(plan.coverage/100000).toFixed(1)} Lakh</span>
                    </div>
                    <div class="coverage-item">
                        <span class="coverage-label">Hospitalization:</span>
                        <span class="coverage-value ${plan.hospitalization.includes('100%') ? 'unlimited' : ''}">${plan.hospitalization}</span>
                    </div>
                    <div class="coverage-item">
                        <span class="coverage-label">Room Rent:</span>
                        <span class="coverage-value">${plan.roomRent}</span>
                    </div>
                    <div class="coverage-item">
                        <span class="coverage-label">Ambulance:</span>
                        <span class="coverage-value">${plan.ambulance}</span>
                    </div>
                </div>
                
                <div class="coverage-details" id="details-${plan.id}">
                    <h4>Detailed Coverage:</h4>
                    <div class="coverage-item">
                        <span class="coverage-label">Pre-Hospitalization:</span>
                        <span class="coverage-value">${plan.preHospitalization}</span>
                    </div>
                    <div class="coverage-item">
                        <span class="coverage-label">Post-Hospitalization:</span>
                        <span class="coverage-value">${plan.postHospitalization}</span>
                    </div>
                    <div class="coverage-item">
                        <span class="coverage-label">Daycare Procedures:</span>
                        <span class="coverage-value">${plan.daycareProcedures}</span>
                    </div>
                    <div class="coverage-item">
                        <span class="coverage-label">Surgery:</span>
                        <span class="coverage-value">${plan.surgery}</span>
                    </div>
                    <div class="coverage-item">
                        <span class="coverage-label">Maternity:</span>
                        <span class="coverage-value">${plan.maternity}</span>
                    </div>
                    
                    <h4>Key Features:</h4>
                    <ul class="features-list">
                        ${plan.features.map(feature => `<li>${feature}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="card-actions">
                    <button class="view-more-btn" onclick="toggleDetails(${plan.id})">
                        üìã View More
                    </button>
                    <button class="buy-btn" onclick="buyInsurance(${plan.id})">
                        üõí Buy Now
                    </button>
                </div>
            `;
            
            return card;
        }

        function toggleDetails(planId) {
            const details = document.getElementById(`details-${planId}`);
            const button = details.previousElementSibling.querySelector('.view-more-btn');
            
            if (details.classList.contains('show')) {
                details.classList.remove('show');
                button.textContent = 'üìã View More';
            } else {
                details.classList.add('show');
                button.textContent = 'üìã View Less';
            }
        }

        function toggleComparison(planId) {
            const index = selectedForComparison.indexOf(planId);
            
            if (index > -1) {
                selectedForComparison.splice(index, 1);
            } else {
                if (selectedForComparison.length >= 4) {
                    alert('You can compare maximum 4 plans at a time.');
                    // Uncheck the checkbox
                    event.target.checked = false;
                    return;
                }
                selectedForComparison.push(planId);
            }
            
            updateCompareButton();
        }

        function updateCompareButton() {
            const compareBtn = document.getElementById('compareBtn');
            const countSpan = document.getElementById('compareCount');
            
            countSpan.textContent = selectedForComparison.length;
            compareBtn.disabled = selectedForComparison.length < 2;
        }

        function filterInsurance() {
            const companySearch = document.getElementById('companySearch').value.toLowerCase();
            const planTypeFilter = document.getElementById('planTypeFilter').value;
            const premiumRange = document.getElementById('premiumRange').value;
            const coverageAmount = document.getElementById('coverageAmount').value;
            
            filteredInsurance = insuranceData.filter(plan => {
                const matchesCompany = plan.companyName.toLowerCase().includes(companySearch) || 
                                     plan.planName.toLowerCase().includes(companySearch);
                const matchesPlanType = !planTypeFilter || plan.planType === planTypeFilter;
                
                let matchesPremium = true;
                if (premiumRange) {
                    const monthly = plan.monthlyPremium;
                    switch (premiumRange) {
                        case '0-1000':
                            matchesPremium = monthly <= 1000;
                            break;
                        case '1000-3000':
                            matchesPremium = monthly > 1000 && monthly <= 3000;
                            break;
                        case '3000-5000':
                            matchesPremium = monthly > 3000 && monthly <= 5000;
                            break;
                        case '5000+':
                            matchesPremium = monthly > 5000;
                            break;
                    }
                }
                
                let matchesCoverage = true;
                if (coverageAmount) {
                    const coverage = plan.coverage;
                    switch (coverageAmount) {
                        case '0-500000':
                            matchesCoverage = coverage <= 500000;
                            break;
                        case '500000-1000000':
                            matchesCoverage = coverage > 500000 && coverage <= 1000000;
                            break;
                        case '1000000-2000000':
                            matchesCoverage = coverage > 1000000 && coverage <= 2000000;
                            break;
                        case '2000000+':
                            matchesCoverage = coverage > 2000000;
                            break;
                    }
                }
                
                return matchesCompany && matchesPlanType && matchesPremium && matchesCoverage;
            });
            
            updateInsuranceGrid();
            updateRecommendedGrid();
        }

        function clearFilters() {
            document.getElementById('companySearch').value = '';
            document.getElementById('planTypeFilter').value = '';
            document.getElementById('premiumRange').value = '';
            document.getElementById('coverageAmount').value = '';
            
            filteredInsurance = [...insuranceData];
            updateInsuranceGrid();
            updateRecommendedGrid();
        }

        function refreshInsurance() {
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('insuranceGrid').style.display = 'none';
            
            // Simulate API call
            setTimeout(() => {
                // Simulate minor premium changes
                insuranceData.forEach(plan => {
                    const change = Math.floor(Math.random() * 200) - 100; // -100 to +100
                    plan.monthlyPremium = Math.max(500, plan.monthlyPremium + change);
                    plan.yearlyPremium = plan.monthlyPremium * 11; // Discount for yearly
                });
                
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('insuranceGrid').style.display = 'grid';
                
                filterInsurance();
                
                // Show refresh notification
                alert('‚úÖ Insurance data refreshed with latest premiums and availability!');
            }, 1500);
        }

        function buyInsurance(planId) {
            const plan = insuranceData.find(p => p.id === planId);
            if (!plan) return;
            
            if (confirm(`Purchase ${plan.planName} from ${plan.companyName}?\n\nPremium: ‚Çπ${plan.monthlyPremium.toLocaleString()}/month\nCoverage: ‚Çπ${(plan.coverage/100000).toFixed(1)} Lakh\n\nYou will be redirected to the official website for secure enrollment.`)) {
                // Generate enrollment reference
                const enrollmentId = 'ENR' + Date.now();
                
                // Show enrollment confirmation
                alert(`üéâ Enrollment Process Started!\n\nPlan: ${plan.planName}\nCompany: ${plan.companyName}\nReference ID: ${enrollmentId}\n\nYou will now be redirected to the official website for secure payment and document upload.`);
                
                // Open external website in new tab
                window.open(plan.website, '_blank');
                
                // Log the enrollment for tracking
                console.log(`Insurance enrollment initiated: ${enrollmentId} for plan ${planId}`);
            }
        }

        function openComparison() {
            if (selectedForComparison.length < 2) return;
            
            const modal = document.getElementById('comparisonModal');
            const table = document.getElementById('comparisonTable');
            
            const selectedPlans = insuranceData.filter(plan => selectedForComparison.includes(plan.id));
            
            // Create comparison table
            let tableHTML = `
                <thead>
                    <tr>
                        <th>Feature</th>
                        ${selectedPlans.map(plan => `<th>${plan.companyName}<br><small>${plan.planName}</small></th>`).join('')}
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Plan Type</strong></td>
                        ${selectedPlans.map(plan => `<td>${plan.planType}</td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Monthly Premium</strong></td>
                        ${selectedPlans.map(plan => `<td><strong>‚Çπ${plan.monthlyPremium.toLocaleString()}</strong></td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Yearly Premium</strong></td>
                        ${selectedPlans.map(plan => `<td><strong>‚Çπ${plan.yearlyPremium.toLocaleString()}</strong></td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Sum Insured</strong></td>
                        ${selectedPlans.map(plan => `<td>‚Çπ${(plan.coverage/100000).toFixed(1)} Lakh</td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Hospitalization</strong></td>
                        ${selectedPlans.map(plan => `<td>${plan.hospitalization}</td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Room Rent</strong></td>
                        ${selectedPlans.map(plan => `<td>${plan.roomRent}</td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Pre-Hospitalization</strong></td>
                        ${selectedPlans.map(plan => `<td>${plan.preHospitalization}</td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Post-Hospitalization</strong></td>
                        ${selectedPlans.map(plan => `<td>${plan.postHospitalization}</td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Ambulance</strong></td>
                        ${selectedPlans.map(plan => `<td>${plan.ambulance}</td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Daycare Procedures</strong></td>
                        ${selectedPlans.map(plan => `<td>${plan.daycareProcedures}</td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Surgery Coverage</strong></td>
                        ${selectedPlans.map(plan => `<td>${plan.surgery}</td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Maternity Coverage</strong></td>
                        ${selectedPlans.map(plan => `<td>${plan.maternity}</td>`).join('')}
                    </tr>
                    <tr>
                        <td><strong>Actions</strong></td>
                        ${selectedPlans.map(plan => `
                            <td>
                                <button class="buy-btn" onclick="buyInsurance(${plan.id}); closeComparison();" style="margin: 5px 0;">
                                    üõí Buy This Plan
                                </button>
                            </td>
                        `).join('')}
                    </tr>
                </tbody>
            `;
            
            table.innerHTML = tableHTML;
            modal.style.display = 'block';
        }

        function closeComparison() {
            document.getElementById('comparisonModal').style.display = 'none';
        }

        function goBackToDashboard() {
            if (confirm('Return to main dashboard?')) {
                // Check if we're in an iframe or being integrated
                if (window.parent !== window) {
                    // We're in an iframe, communicate with parent
                    window.parent.postMessage({ action: 'showSection', section: 'dashboard' }, '*');
                } else {
                    // Standalone mode, redirect to ready2.html
                    window.location.href = 'ready2.html#dashboard';
                }
            }
        }

        // Listen for messages from parent window
        window.addEventListener('message', function(event) {
            if (event.data.action === 'updatePatientProfile') {
                // Update recommendations based on patient profile
                updateRecommendationsForPatient(event.data.profile);
            }
        });

        function updateRecommendationsForPatient(profile) {
            // Update the recommendation section based on patient profile
            const sectionTitle = document.querySelector('.recommended-section .section-title p');
            if (profile) {
                sectionTitle.textContent = `Based on your profile: Age ${profile.age}, Health conditions: ${profile.conditions.join(', ')}`;
            }
            
            // Re-evaluate recommendations based on profile
            insuranceData.forEach(plan => {
                plan.recommended = evaluateRecommendation(plan, profile);
            });
            
            updateRecommendedGrid();
        }

        function evaluateRecommendation(plan, profile) {
            if (!profile) return plan.recommended;
            
            // Simple recommendation logic based on age and conditions
            const age = profile.age || 32;
            const conditions = profile.conditions || ['Diabetes', 'Hypertension'];
            
            // Recommend family floater for younger patients
            if (age < 40 && plan.planType === 'Family Floater') return true;
            
            // Recommend senior citizen plans for older patients
            if (age >= 60 && plan.planType === 'Senior Citizen') return true;
            
            // Recommend critical illness for patients with chronic conditions
            if (conditions.some(c => ['Diabetes', 'Hypertension', 'Heart Disease'].includes(c)) && 
                plan.planType === 'Critical Illness') return true;
            
            // Recommend maternity plans for women in reproductive age
            if (age >= 25 && age <= 45 && plan.planType === 'Maternity') return true;
            
            return false;
        }

        // Modal close handlers
        window.onclick = function(event) {
            const modal = document.getElementById('comparisonModal');
            if (event.target === modal) {
                closeComparison();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeComparison();
            }
            
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                document.getElementById('companySearch').focus();
            }
        });

        // Auto-refresh data every 5 minutes
        setInterval(() => {
            if (Math.random() < 0.3) { // 30% chance to refresh
                console.log('Auto-refreshing insurance data...');
                // Simulate small premium changes
                insuranceData.forEach(plan => {
                    if (Math.random() < 0.2) {
                        const change = Math.floor(Math.random() * 100) - 50;
                        plan.monthlyPremium = Math.max(500, plan.monthlyPremium + change);
                        plan.yearlyPremium = plan.monthlyPremium * 11;
                    }
                });
                
                // Update display if no filters are active
                if (filteredInsurance.length === insuranceData.length) {
                    updateInsuranceGrid();
                    updateRecommendedGrid();
                }
            }
        }, 300000); // 5 minutes
    </script>
</body>
</html>