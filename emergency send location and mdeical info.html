<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency SOS - HealthConnect</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .emergency-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .patient-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-card {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .info-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 600;
            color: #666;
        }
        
        .info-value {
            color: #333;
            font-weight: 500;
        }
        
        .emergency-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .sos-button {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            border: none;
            padding: 40px 30px;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .sos-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(220, 38, 38, 0.4);
        }
        
        .sos-button.activating {
            animation: emergency-flash 0.5s infinite;
        }
        
        @keyframes emergency-flash {
            0%, 100% { background: linear-gradient(135deg, #dc2626, #ef4444); }
            50% { background: linear-gradient(135deg, #f59e0b, #f97316); }
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .quick-btn {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 2px solid #667eea;
            padding: 15px 20px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .quick-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        
        .emergency-status {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            display: none;
            backdrop-filter: blur(20px);
        }
        
        .emergency-status.active {
            display: block;
            animation: slideIn 0.6s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc2626, #ef4444);
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .notifications-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
        }
        
        .notification-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .notification-item:hover {
            background: #e9ecef;
        }
        
        .notification-item.success {
            border-left: 4px solid #16a34a;
            background: #f0fdf4;
        }
        
        .notification-item.pending {
            border-left: 4px solid #f59e0b;
            background: #fffbeb;
        }
        
        .notification-item.error {
            border-left: 4px solid #dc2626;
            background: #fef2f2;
        }
        
        .notification-icon {
            font-size: 1.5rem;
        }
        
        .location-display {
            background: linear-gradient(135deg, #059669, #16a34a);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .location-coords {
            font-family: monospace;
            font-size: 1.1rem;
            margin: 10px 0;
        }
        
        .map-link {
            color: white;
            text-decoration: underline;
            font-weight: 600;
        }
        
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .contact-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .contact-card.notified {
            border-color: #16a34a;
            background: #f0fdf4;
        }
        
        .medical-summary {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .medical-summary h4 {
            margin-bottom: 10px;
        }
        
        .medical-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 8px;
            margin: 5px 0;
            font-weight: 500;
        }
        
        .emergency-id {
            background: #1f2937;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-family: monospace;
            text-align: center;
            margin: 15px 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .cancel-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        
        .cancel-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .hospital-alert {
            background: rgba(37, 99, 235, 0.1);
            border: 2px solid #2563eb;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .hospital-alert h3 {
            color: #2563eb;
            margin-bottom: 10px;
        }
        
        .eta-display {
            font-size: 2rem;
            font-weight: 700;
            color: #dc2626;
            margin: 10px 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #333;
        }
        
        .audio-controls {
            margin: 20px 0;
            text-align: center;
        }
        
        .audio-btn {
            background: #16a34a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            margin: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .settings-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #667eea;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .emergency-panel {
                padding: 20px;
            }
            
            .sos-button {
                padding: 30px 20px;
                font-size: 1.2rem;
            }
            
            .patient-info {
                grid-template-columns: 1fr;
            }
            
            .emergency-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö® Emergency SOS System</h1>
            <p>Instant emergency response with location tracking and medical data sharing</p>
        </div>

        <!-- Patient Information Panel -->
        <div class="emergency-panel">
            <h2>Patient Information</h2>
            <div class="patient-info">
                <div class="info-card">
                    <h3>üë§ Personal Details</h3>
                    <div class="info-item">
                        <span class="info-label">Name:</span>
                        <span class="info-value" id="patientName">ANIL MISHRA</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Age:</span>
                        <span class="info-value" id="patientAge">35 years</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Gender:</span>
                        <span class="info-value" id="patientGender">Male</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Blood Group:</span>
                        <span class="info-value" id="bloodGroup">B+ Positive</span>
                    </div>
                </div>

                <div class="info-card">
                    <h3>‚ö†Ô∏è Critical Medical Info</h3>
                    <div class="info-item">
                        <span class="info-label">Allergies:</span>
                        <span class="info-value" id="allergies">Penicillin, Shellfish</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Current Medications:</span>
                        <span class="info-value" id="medications">Metformin, Lisinopril</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Medical Conditions:</span>
                        <span class="info-value" id="conditions">Diabetes Type 2, Hypertension</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Last Updated:</span>
                        <span class="info-value" id="lastUpdated">March 10, 2025</span>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üìû Emergency Contacts</h3>
                    <div class="info-item">
                        <span class="info-label">Primary Contact:</span>
                        <span class="info-value">RENUKA MISHRA (Wife)</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Phone:</span>
                        <span class="info-value">+91-9876543210</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Secondary Contact:</span>
                        <span class="info-value">Dr. Rajesh Kumar</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Phone:</span>
                        <span class="info-value">+91-9876543211</span>
                    </div>
                </div>
            </div>

            <h2>Emergency Actions</h2>
            <div class="emergency-actions">
                <button class="sos-button" onclick="activateEmergencySOS()">
                    üö® ACTIVATE EMERGENCY SOS
                    <br><small style="font-size: 0.8rem; opacity: 0.9;">Send location + medical info</small>
                </button>

                <div class="quick-actions">
                    <button class="quick-btn" onclick="shareLocation()">üìç Share Live Location</button>
                    <button class="quick-btn" onclick="callEmergency()">üìû Call 102/Emergency</button>
                    <button class="quick-btn" onclick="generateQRCode()">üì± Generate QR Passport</button>
                    <button class="quick-btn" onclick="silentAlert()">üîá Silent Emergency Alert</button>
                </div>
            </div>
        </div>

        <!-- Emergency Status Panel -->
        <div id="emergencyStatus" class="emergency-status">
            <div class="status-header">
                <div class="status-icon">üö®</div>
                <div>
                    <h2>EMERGENCY ACTIVATED</h2>
                    <p id="statusMessage">Initializing emergency response...</p>
                </div>
            </div>

            <div class="emergency-id" id="emergencyId"></div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
            <p id="progressText">Processing emergency request...</p>

            <div class="location-display" id="locationDisplay" style="display: none;">
                <h4>üìç Current Location Shared</h4>
                <div class="location-coords" id="coordinates"></div>
                <div><a href="#" class="map-link" id="mapLink" target="_blank">View on Google Maps</a></div>
            </div>

            <div class="medical-summary" id="medicalSummary" style="display: none;">
                <h4>üè• Medical Information Sent</h4>
                <div class="medical-item">Blood Type: B+ Positive</div>
                <div class="medical-item">Allergies: Penicillin, Shellfish</div>
                <div class="medical-item">Medications: Metformin, Lisinopril</div>
                <div class="medical-item">Conditions: Diabetes, Hypertension</div>
            </div>

            <div class="hospital-alert" id="hospitalAlert" style="display: none;">
                <h3>üè• Hospital Notified</h3>
                <p>AIIMS Delhi Emergency Department has been alerted</p>
                <div class="eta-display" id="ambulanceETA">ETA: 8 minutes</div>
                <p>Ambulance dispatched ‚Ä¢ Emergency bed reserved</p>
            </div>

            <div class="audio-controls">
                <button class="audio-btn" onclick="toggleSiren()">üîä Emergency Siren</button>
                <button class="cancel-btn" onclick="cancelEmergency()">‚ùå Cancel Emergency</button>
            </div>
        </div>

        <!-- Notifications Panel -->
        <div class="notifications-panel">
            <h2>üì¢ Emergency Notifications</h2>
            <div id="notificationsList">
                <div class="notification-item">
                    <span class="notification-icon">‚ÑπÔ∏è</span>
                    <div>
                        <strong>System Ready</strong>
                        <p>Emergency SOS system is armed and ready</p>
                        <small>Location services: Active ‚Ä¢ Medical data: Encrypted</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Contacts Grid -->
        <div class="notifications-panel">
            <h2>üìû Emergency Contact Status</h2>
            <div class="contact-grid" id="contactGrid">
                <div class="contact-card">
                    <strong>RENUKA MISHRA (Wife)</strong>
                    <p>+91-9876543210</p>
                    <small>Primary Emergency Contact</small>
                </div>
                <div class="contact-card">
                    <strong>Dr. Rajesh Kumar</strong>
                    <p>+91-9876543211</p>
                    <small>Primary Care Physician</small>
                </div>
                <div class="contact-card">
                    <strong>RAHUL MISHRA (Brother)</strong>
                    <p>+91-9876543212</p>
                    <small>Secondary Contact</small>
                </div>
                <div class="contact-card">
                    <strong>AIIMS Emergency Dept</strong>
                    <p>+91-11-26588500</p>
                    <small>Hospital Emergency Line</small>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel">
            <h2>‚öôÔ∏è Emergency Settings</h2>
            <div class="settings-grid">
                <div class="setting-item">
                    <div>
                        <strong>Auto Location Sharing</strong>
                        <p>Share GPS automatically on emergency</p>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div>
                        <strong>Silent Mode Available</strong>
                        <p>Enable silent emergency alerts</p>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div>
                        <strong>SMS Notifications</strong>
                        <p>Send SMS to emergency contacts</p>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div>
                        <strong>WhatsApp Alerts</strong>
                        <p>Send WhatsApp messages</p>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Emergency Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>‚ö†Ô∏è Confirm Emergency Activation</h2>
            <p style="margin: 20px 0;">This will immediately:</p>
            <ul style="margin: 20px 0; padding-left: 30px;">
                <li>Share your current GPS location</li>
                <li>Send your medical information to emergency responders</li>
                <li>Notify all emergency contacts</li>
                <li>Alert nearest hospitals</li>
                <li>Dispatch emergency services if available</li>
            </ul>
            <p><strong>Only proceed if this is a real medical emergency!</strong></p>
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="confirmEmergency()" style="background: #dc2626; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-weight: 600; margin: 10px; cursor: pointer;">
                    üö® YES, ACTIVATE EMERGENCY
                </button>
                <button onclick="closeModal()" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let emergencyActive = false;
        let currentLocation = null;
        let emergencyId = null;
        let sirenAudio = null;
        let progressInterval = null;

        // Initialize the system
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize geolocation
            getCurrentLocation();
            
            // Initialize audio
            initializeAudio();
            
            // Check for emergency in URL (for testing)
            if (window.location.hash === '#emergency-test') {
                setTimeout(() => {
                    activateEmergencySOS();
                }, 1000);
            }
        });

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        currentLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: new Date().toISOString()
                        };
                        
                        addNotification('success', 'Location Services Active', 
                            `GPS coordinates acquired (¬±${Math.round(position.coords.accuracy)}m accuracy)`);
                    },
                    function(error) {
                        addNotification('error', 'Location Access Denied', 
                            'Please enable location services for emergency features');
                        
                        // Simulate location for demo
                        currentLocation = {
                            latitude: 28.6139,  // Delhi coordinates
                            longitude: 77.2090,
                            accuracy: 10,
                            timestamp: new Date().toISOString()
                        };
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            } else {
                addNotification('error', 'Geolocation Not Supported', 
                    'This device does not support location services');
            }
        }

        function initializeAudio() {
            // Create audio context for emergency siren
            try {
                sirenAudio = new Audio();
                sirenAudio.loop = true;
                // Note: In a real implementation, you would load an actual siren sound file
                // For demo purposes, we'll use Web Audio API to generate a siren sound
            } catch (error) {
                console.log('Audio not available');
            }
        }

        function activateEmergencySOS() {
            if (emergencyActive) {
                addNotification('error', 'Emergency Already Active', 
                    'An emergency is already in progress');
                return;
            }
            
            document.getElementById('confirmModal').style.display = 'block';
        }

        function confirmEmergency() {
            closeModal();
            
            emergencyActive = true;
            emergencyId = 'EMG' + Date.now();
            
            // Show emergency status panel
            document.getElementById('emergencyStatus').classList.add('active');
            document.getElementById('emergencyId').textContent = `Emergency ID: ${emergencyId}`;
            
            // Animate SOS button
            document.querySelector('.sos-button').classList.add('activating');
            
            // Start emergency sequence
            startEmergencySequence();
        }

        function startEmergencySequence() {
            const steps = [
                { progress: 15, message: "üîê Encrypting medical data...", action: encryptMedicalData },
                { progress: 30, message: "üìç Acquiring precise GPS location...", action: getEmergencyLocation },
                { progress: 45, message: "üì± Sending SMS to emergency contacts...", action: notifyEmergencyContacts },
                { progress: 60, message: "üìß Sending WhatsApp & email alerts...", action: sendDigitalAlerts },
                { progress: 75, message: "üè• Notifying nearest hospitals...", action: alertHospitals },
                { progress: 90, message: "üöë Dispatching emergency services...", action: dispatchEmergencyServices },
                { progress: 100, message: "‚úÖ Emergency response activated!", action: completeEmergencyActivation }
            ];
            
            let currentStep = 0;
            
            progressInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    const step = steps[currentStep];
                    
                    // Update progress bar
                    document.getElementById('progressFill').style.width = step.progress + '%';
                    document.getElementById('progressText').textContent = step.message;
                    document.getElementById('statusMessage').textContent = step.message;
                    
                    // Execute step action
                    if (step.action) {
                        step.action();
                    }
                    
                    currentStep++;
                } else {
                    clearInterval(progressInterval);
                }
            }, 2000); // 2 seconds per step
        }

        function encryptMedicalData() {
            addNotification('pending', 'Encrypting Medical Data', 
                'Patient medical information secured with AES-256 encryption');
        }

        function getEmergencyLocation() {
            if (currentLocation) {
                const coords = `${currentLocation.latitude.toFixed(6)}, ${currentLocation.longitude.toFixed(6)}`;
                document.getElementById('coordinates').textContent = coords;
                
                const mapUrl = `https://www.google.com/maps?q=${currentLocation.latitude},${currentLocation.longitude}`;
                document.getElementById('mapLink').href = mapUrl;
                document.getElementById('locationDisplay').style.display = 'block';
                
                addNotification('success', 'Location Acquired', 
                    `GPS coordinates: ${coords} (¬±${currentLocation.accuracy}m)`);
            } else {
                addNotification('error', 'Location Unavailable', 
                    'Using last known location from medical records');
            }
        }

        function notifyEmergencyContacts() {
            const contacts = document.querySelectorAll('.contact-card');
            
            contacts.forEach((contact, index) => {
                setTimeout(() => {
                    contact.classList.add('notified');
                    const name = contact.querySelector('strong').textContent;
                    addNotification('success', `SMS Sent: ${name}`, 
                        'Emergency alert with location and medical info delivered');
                }, index * 500);
            });
        }

        function sendDigitalAlerts() {
            addNotification('success', 'WhatsApp Messages Sent', 
                'Emergency alerts sent to all WhatsApp contacts');
            
            setTimeout(() => {
                addNotification('success', 'Email Alerts Sent', 
                    'Emergency emails sent to registered contacts and healthcare providers');
            }, 1000);
        }

        function alertHospitals() {
            document.getElementById('medicalSummary').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('hospitalAlert').style.display = 'block';
                addNotification('success', 'Hospital Notified', 
                    'AIIMS Delhi Emergency Department alerted - Ambulance dispatched');
            }, 1000);
        }

        function dispatchEmergencyServices() {
            addNotification('success', 'Emergency Services Dispatched', 
                'Local emergency services notified and en route');
            
            // Start ETA countdown
            startETACountdown();
        }

        function completeEmergencyActivation() {
            addNotification('success', 'Emergency Response Complete', 
                'All emergency protocols activated successfully');
            
            // Show final status
            document.getElementById('statusMessage').textContent = 
                'Emergency active - Help is on the way!';
                
            // Stop button animation
            document.querySelector('.sos-button').classList.remove('activating');
        }

        function startETACountdown() {
            let eta = 8; // 8 minutes
            const etaDisplay = document.getElementById('ambulanceETA');
            
            const countdown = setInterval(() => {
                if (eta > 0) {
                    etaDisplay.textContent = `ETA: ${eta} minutes`;
                    eta--;
                } else {
                    etaDisplay.textContent = 'Ambulance Arriving Now!';
                    clearInterval(countdown);
                    
                    addNotification('success', 'Ambulance Arrival', 
                        'Emergency services have arrived at your location');
                }
            }, 60000); // Update every minute
        }

        function shareLocation() {
            if (currentLocation) {
                const coords = `${currentLocation.latitude.toFixed(6)}, ${currentLocation.longitude.toFixed(6)}`;
                const mapUrl = `https://www.google.com/maps?q=${currentLocation.latitude},${currentLocation.longitude}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'My Current Location - Health Emergency',
                        text: `Emergency Location Share: ${coords}`,
                        url: mapUrl
                    });
                } else {
                    // Fallback for browsers without native sharing
                    navigator.clipboard.writeText(`Emergency Location: ${coords} - ${mapUrl}`)
                        .then(() => {
                            addNotification('success', 'Location Copied', 
                                'Location link copied to clipboard - Share with emergency contacts');
                        });
                }
                
                addNotification('success', 'Live Location Shared', 
                    'Current GPS coordinates shared with emergency contacts');
            } else {
                addNotification('error', 'Location Unavailable', 
                    'Unable to access current location');
            }
        }

        function callEmergency() {
            // Different emergency numbers by region
            const emergencyNumbers = {
                'IN': '112',  // India
                'US': '911',  // United States
                'GB': '999',  // United Kingdom
                'AU': '000'   // Australia
            };
            
            const countryCode = 'IN'; // Default to India for this demo
            const number = emergencyNumbers[countryCode] || '112';
            
            if (confirm(`Call emergency services (${number})?`)) {
                addNotification('success', 'Emergency Call Initiated', 
                    `Dialing ${number} - Emergency services will be notified of your medical condition`);
                
                // In a real app, this would initiate the call
                window.location.href = `tel:${number}`;
            }
        }

        function generateQRCode() {
            const medicalData = {
                name: document.getElementById('patientName').textContent,
                age: document.getElementById('patientAge').textContent,
                bloodGroup: document.getElementById('bloodGroup').textContent,
                allergies: document.getElementById('allergies').textContent,
                medications: document.getElementById('medications').textContent,
                conditions: document.getElementById('conditions').textContent,
                emergencyContact: '+91-9876543210',
                location: currentLocation ? 
                    `${currentLocation.latitude.toFixed(6)}, ${currentLocation.longitude.toFixed(6)}` : 
                    'Location unavailable',
                timestamp: new Date().toISOString(),
                emergencyId: `QR${Date.now()}`
            };
            
            // In a real implementation, you would generate an actual QR code
            // For this demo, we'll show the data that would be encoded
            const qrData = JSON.stringify(medicalData, null, 2);
            
            alert(`üî≤ QR Health Passport Generated!\n\nThis QR code contains:\n${qrData}\n\n‚ö†Ô∏è QR Code ID: ${medicalData.emergencyId}\n\nValid for 24 hours. Show to any medical professional for instant access to your critical health information.`);
            
            addNotification('success', 'QR Passport Generated', 
                `Emergency QR code created - ID: ${medicalData.emergencyId}`);
        }

        function silentAlert() {
            if (confirm('Send silent emergency alert?\n\nThis will notify emergency contacts without sound or visible alerts on your device.')) {
                // Simulate silent alert
                setTimeout(() => {
                    addNotification('success', 'Silent Alert Sent', 
                        'Discrete emergency notification sent to all contacts');
                }, 1000);
                
                // Send location and basic info silently
                if (currentLocation) {
                    const coords = `${currentLocation.latitude.toFixed(6)}, ${currentLocation.longitude.toFixed(6)}`;
                    setTimeout(() => {
                        addNotification('success', 'Location Shared Silently', 
                            `GPS coordinates sent: ${coords}`);
                    }, 2000);
                }
            }
        }

        function toggleSiren() {
            if (sirenAudio && !sirenAudio.paused) {
                sirenAudio.pause();
                document.querySelector('.audio-btn').textContent = 'üîä Emergency Siren';
                addNotification('success', 'Siren Stopped', 'Emergency siren deactivated');
            } else {
                // Simulate siren activation
                addNotification('success', 'Siren Activated', 
                    'Emergency siren sound activated to attract attention');
                document.querySelector('.audio-btn').textContent = 'üîá Stop Siren';
                
                // In a real app, this would play an actual siren sound
                console.log('Emergency siren activated');
            }
        }

        function cancelEmergency() {
            if (confirm('Cancel emergency alert?\n\nThis will stop all emergency protocols and notify contacts that the emergency has been resolved.')) {
                emergencyActive = false;
                
                // Clear intervals
                if (progressInterval) {
                    clearInterval(progressInterval);
                }
                
                // Hide emergency status
                document.getElementById('emergencyStatus').classList.remove('active');
                
                // Reset contact cards
                document.querySelectorAll('.contact-card').forEach(card => {
                    card.classList.remove('notified');
                });
                
                // Stop siren if playing
                if (sirenAudio && !sirenAudio.paused) {
                    sirenAudio.pause();
                }
                
                addNotification('success', 'Emergency Cancelled', 
                    'Emergency alert cancelled - Contacts notified of resolution');
            }
        }

        function addNotification(type, title, message) {
            const notificationsList = document.getElementById('notificationsList');
            const notification = document.createElement('div');
            notification.className = `notification-item ${type}`;
            
            const icons = {
                success: '‚úÖ',
                pending: '‚è≥',
                error: '‚ùå',
                info: '‚ÑπÔ∏è'
            };
            
            notification.innerHTML = `
                <span class="notification-icon">${icons[type] || '‚ÑπÔ∏è'}</span>
                <div>
                    <strong>${title}</strong>
                    <p>${message}</p>
                    <small>${new Date().toLocaleTimeString()}</small>
                </div>
            `;
            
            // Add to top of list
            notificationsList.insertBefore(notification, notificationsList.firstChild);
            
            // Remove old notifications if too many
            const notifications = notificationsList.querySelectorAll('.notification-item');
            if (notifications.length > 8) {
                notifications[notifications.length - 1].remove();
            }
        }

        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl + E for emergency (be careful with this in production)
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                activateEmergencySOS();
            }
            
            // Escape to close modal
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('confirmModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Auto-refresh location every 30 seconds when emergency is active
        setInterval(() => {
            if (emergencyActive) {
                getCurrentLocation();
            }
        }, 30000);

        // Initialize status updates
        setTimeout(() => {
            addNotification('info', 'System Check Complete', 
                'All emergency systems operational and ready');
        }, 1000);
    </script>
</body>
</html>